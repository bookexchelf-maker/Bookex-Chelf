# ğŸ¯ Payment System - Visual Guide & Flow Diagrams

## Complete User Journey

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        BOOK CHELF                               â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ DASHBOARD (Logged In, Free User)                        â”‚   â”‚
â”‚  â”‚                                                         â”‚   â”‚
â”‚  â”‚ âœ“ Read your books                                       â”‚   â”‚
â”‚  â”‚ âœ“ Track reading progress                               â”‚   â”‚
â”‚  â”‚ âœ“ Manage shelves (Limited: 3 max)                       â”‚   â”‚
â”‚  â”‚ âœ“ Manage books (Limited: 12 max)                        â”‚   â”‚
â”‚  â”‚                                                         â”‚   â”‚
â”‚  â”‚ [ğŸ”“ Upgrade to Premium â† Click here!]                   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                          â†“                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ /pricing (Pricing Page)                                 â”‚   â”‚
â”‚  â”‚                                                         â”‚   â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚   â”‚
â”‚  â”‚ â”‚ FREE PLAN       â”‚  â”‚ PREMIUM PLAN â­ â‚¹299    â”‚        â”‚   â”‚
â”‚  â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤        â”‚   â”‚
â”‚  â”‚ â”‚ Your current    â”‚  â”‚ âœ… Unlimited shelves   â”‚        â”‚   â”‚
â”‚  â”‚ â”‚ plan âœ“          â”‚  â”‚ âœ… Unlimited books     â”‚        â”‚   â”‚
â”‚  â”‚ â”‚                 â”‚  â”‚ âœ… Advanced stats      â”‚        â”‚   â”‚
â”‚  â”‚ â”‚ â”œ 3 shelves     â”‚  â”‚                         â”‚        â”‚   â”‚
â”‚  â”‚ â”‚ â”œ 12 books      â”‚  â”‚ [ğŸ’³ Stripe] [ğŸ‡®ğŸ‡³ Razorpay] â”‚   â”‚   â”‚
â”‚  â”‚ â”‚ â”” Basic stats   â”‚  â”‚ (Choose payment)       â”‚        â”‚   â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸŒ€ Stripe Payment Flow (Complete)

```
USER SIDE:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                 â”‚
â”‚  /pricing page                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                           â”‚
â”‚  â”‚ ğŸ’³ Pay with Card (Stripe)        â”‚ â† Click                   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                           â”‚
â”‚               â”‚                                                 â”‚
â”‚               â†“                                                 â”‚
â”‚  POST /create-checkout-session                                  â”‚
â”‚  (Form submits to Flask)                                        â”‚
â”‚               â”‚                                                 â”‚
â”‚               â†“                                                 â”‚
â”‚  Redirect to Stripe checkout page                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                         â”‚
â”‚  â”‚ Stripe Secure Checkout             â”‚                         â”‚
â”‚  â”‚                                    â”‚                         â”‚
â”‚  â”‚ Card Number:  [4242 4242...]       â”‚                         â”‚
â”‚  â”‚ Expiry Date:  [12/25]              â”‚                         â”‚
â”‚  â”‚ CVC:          [123]                â”‚                         â”‚
â”‚  â”‚                                    â”‚                         â”‚
â”‚  â”‚ [Complete Payment â†’]               â”‚ â† Fill in & click       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                         â”‚
â”‚               â”‚                                                 â”‚
â”‚               â†“                                                 â”‚
â”‚  "Payment successful!"                                          â”‚
â”‚  (Redirect happens here or stays at Stripe)                     â”‚
â”‚               â”‚                                                 â”‚
â”‚               â†“                                                 â”‚
â”‚  Auto-redirect to /payment/success                              â”‚
â”‚  (Or /dashboard depending on config)                            â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

SERVER SIDE (ASYNCHRONOUS):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                 â”‚
â”‚  POST /create-checkout-session                                  â”‚
â”‚  (Receives form data)                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                       â”‚
â”‚  â”‚ Get user_id from session             â”‚                       â”‚
â”‚  â”‚ Create Stripe checkout session:      â”‚                       â”‚
â”‚  â”‚ - Amount: 29900 (â‚¹299)               â”‚                       â”‚
â”‚  â”‚ - Currency: INR                      â”‚                       â”‚
â”‚  â”‚ - metadata: {user_id: 123}           â”‚                       â”‚
â”‚  â”‚ Return: checkout_session.url         â”‚                       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                       â”‚
â”‚               â†“                                                 â”‚
â”‚  (Waiting for user to complete payment...)                      â”‚
â”‚               â”‚                                                 â”‚
â”‚               â†“                                                 â”‚
â”‚  [WEBHOOK ARRIVES - ASYNCHRONOUS]                               â”‚
â”‚  POST /webhook/stripe                                           â”‚
â”‚  (From Stripe servers)                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                       â”‚
â”‚  â”‚ Stripe sends webhook event:          â”‚                       â”‚
â”‚  â”‚ {                                    â”‚                       â”‚
â”‚  â”‚   type: "checkout.session.completed" â”‚                       â”‚
â”‚  â”‚   data: {                            â”‚                       â”‚
â”‚  â”‚     object: {                        â”‚                       â”‚
â”‚  â”‚       metadata: {user_id: 123}       â”‚                       â”‚
â”‚  â”‚     }                                â”‚                       â”‚
â”‚  â”‚   }                                  â”‚                       â”‚
â”‚  â”‚   signature: "xxxxx"                 â”‚                       â”‚
â”‚  â”‚ }                                    â”‚                       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                       â”‚
â”‚               â”‚                                                 â”‚
â”‚               â†“                                                 â”‚
â”‚  Verify webhook signature:                                      â”‚
â”‚  âœ“ Signature matches STRIPE_WEBHOOK_SECRET                      â”‚
â”‚               â”‚                                                 â”‚
â”‚               â†“                                                 â”‚
â”‚  Update database:                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                       â”‚
â”‚  â”‚ user = User.query.get(user_id: 123)  â”‚                       â”‚
â”‚  â”‚ user.is_premium = True               â”‚                       â”‚
â”‚  â”‚ user.premium_since = NOW()           â”‚                       â”‚
â”‚  â”‚ user.premium_until = NOW() + 365d    â”‚                       â”‚
â”‚  â”‚ db.session.commit()                  â”‚                       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                       â”‚
â”‚               â”‚                                                 â”‚
â”‚               â†“                                                 â”‚
â”‚  Return 200 OK to Stripe                                        â”‚
â”‚  (Webhook processed successfully)                               â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸŒ€ Razorpay Payment Flow (Complete)

```
USER SIDE:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                 â”‚
â”‚  /pricing page                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                           â”‚
â”‚  â”‚ ğŸ‡®ğŸ‡³ Pay with UPI/Card (Razorpay) â”‚ â† Click                   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                           â”‚
â”‚               â”‚                                                 â”‚
â”‚               â†“                                                 â”‚
â”‚  JavaScript: fetch('/create-razorpay-order')                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                           â”‚
â”‚  â”‚ POST /create-razorpay-order      â”‚                           â”‚
â”‚  â”‚ (AJAX call from browser)         â”‚                           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                           â”‚
â”‚               â”‚                                                 â”‚
â”‚               â†“                                                 â”‚
â”‚  Response: {                                                    â”‚
â”‚    order_id: "order_xxxxx",                                    â”‚
â”‚    amount: 29900,                                              â”‚
â”‚    key: "rzp_test_xxxxx"                                       â”‚
â”‚  }                                                              â”‚
â”‚               â”‚                                                 â”‚
â”‚               â†“                                                 â”‚
â”‚  JavaScript opens Razorpay popup:                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                         â”‚
â”‚  â”‚ Razorpay Payment Popup             â”‚                         â”‚
â”‚  â”‚                                    â”‚                         â”‚
â”‚  â”‚ Select Payment Method:             â”‚                         â”‚
â”‚  â”‚ [âœ“] UPI                            â”‚                         â”‚
â”‚  â”‚ [ ] Credit Card                    â”‚                         â”‚
â”‚  â”‚ [ ] Netbanking                     â”‚                         â”‚
â”‚  â”‚ [ ] Wallet                         â”‚                         â”‚
â”‚  â”‚                                    â”‚                         â”‚
â”‚  â”‚ UPI ID: [success@razorpay    ]     â”‚                         â”‚
â”‚  â”‚                                    â”‚                         â”‚
â”‚  â”‚ [Proceed to Payment â†’]             â”‚ â† Enter & click         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                         â”‚
â”‚               â”‚                                                 â”‚
â”‚               â†“                                                 â”‚
â”‚  (Payment processing on Razorpay...)                            â”‚
â”‚               â”‚                                                 â”‚
â”‚               â†“                                                 â”‚
â”‚  Razorpay returns response to browser:                          â”‚
â”‚  {                                                              â”‚
â”‚    razorpay_payment_id: "pay_xxxxx",                           â”‚
â”‚    razorpay_order_id: "order_xxxxx",                           â”‚
â”‚    razorpay_signature: "signature_hash"                         â”‚
â”‚  }                                                              â”‚
â”‚               â”‚                                                 â”‚
â”‚               â†“                                                 â”‚
â”‚  JavaScript: fetch('/verify-razorpay-payment')                  â”‚
â”‚  POST with {payment_id, order_id, signature}                    â”‚
â”‚               â”‚                                                 â”‚
â”‚               â†“                                                 â”‚
â”‚  Response: {success: true}                                      â”‚
â”‚               â”‚                                                 â”‚
â”‚               â†“                                                 â”‚
â”‚  JavaScript: window.location = '/dashboard'                     â”‚
â”‚               â”‚                                                 â”‚
â”‚               â†“                                                 â”‚
â”‚  Redirected to Dashboard                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                         â”‚
â”‚  â”‚ ğŸ‰ Welcome to Book Chelf Premium!  â”‚                         â”‚
â”‚  â”‚                                    â”‚                         â”‚
â”‚  â”‚ You now have access to:            â”‚                         â”‚
â”‚  â”‚ âœ… Unlimited shelves               â”‚                         â”‚
â”‚  â”‚ âœ… Unlimited books                 â”‚                         â”‚
â”‚  â”‚ âœ… Advanced statistics             â”‚                         â”‚
â”‚  â”‚                                    â”‚                         â”‚
â”‚  â”‚ Premium until: 2025-01-19          â”‚                         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                         â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

SERVER SIDE:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                 â”‚
â”‚  POST /create-razorpay-order                                    â”‚
â”‚  (Direct call - not form submission)                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                       â”‚
â”‚  â”‚ Get user_id from session             â”‚                       â”‚
â”‚  â”‚ Create Razorpay order:               â”‚                       â”‚
â”‚  â”‚ razorpay_client.order.create({       â”‚                       â”‚
â”‚  â”‚   amount: 29900,  (â‚¹299 in paise)   â”‚                       â”‚
â”‚  â”‚   currency: "INR",                   â”‚                       â”‚
â”‚  â”‚   receipt: f"premium_{user.id}"      â”‚                       â”‚
â”‚  â”‚ })                                   â”‚                       â”‚
â”‚  â”‚ Return: {order_id, amount, key}      â”‚                       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                       â”‚
â”‚               â”‚                                                 â”‚
â”‚               â†“                                                 â”‚
â”‚  (Razorpay popup opens on client browser...)                    â”‚
â”‚  (User completes payment on Razorpay...)                        â”‚
â”‚               â”‚                                                 â”‚
â”‚               â†“                                                 â”‚
â”‚  POST /verify-razorpay-payment                                  â”‚
â”‚  (Direct call from browser)                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                       â”‚
â”‚  â”‚ Receive: {payment_id, order_id,      â”‚                       â”‚
â”‚  â”‚           signature}                 â”‚                       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                       â”‚
â”‚               â”‚                                                 â”‚
â”‚               â†“                                                 â”‚
â”‚  Verify HMAC-SHA256 signature:                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                       â”‚
â”‚  â”‚ message = f"{order_id}|{payment_id}" â”‚                       â”‚
â”‚  â”‚ generated_sig = HMAC-SHA256(          â”‚                       â”‚
â”‚  â”‚   message,                           â”‚                       â”‚
â”‚  â”‚   RAZORPAY_KEY_SECRET                â”‚                       â”‚
â”‚  â”‚ )                                    â”‚                       â”‚
â”‚  â”‚ if (generated_sig == signature):     â”‚                       â”‚
â”‚  â”‚   âœ“ Verified - Process payment       â”‚                       â”‚
â”‚  â”‚ else:                                â”‚                       â”‚
â”‚  â”‚   âœ— Invalid - Reject payment         â”‚                       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                       â”‚
â”‚               â”‚                                                 â”‚
â”‚               â†“ (If signature valid)                            â”‚
â”‚  Update database:                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                       â”‚
â”‚  â”‚ user = User.query.get(user_id)       â”‚                       â”‚
â”‚  â”‚ user.is_premium = True               â”‚                       â”‚
â”‚  â”‚ user.premium_since = NOW()           â”‚                       â”‚
â”‚  â”‚ user.premium_until = NOW() + 365d    â”‚                       â”‚
â”‚  â”‚ db.session.commit()                  â”‚                       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                       â”‚
â”‚               â”‚                                                 â”‚
â”‚               â†“                                                 â”‚
â”‚  Return JSON: {success: true}                                   â”‚
â”‚  (Browser receives this and redirects to dashboard)             â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”€ Comparison: Stripe vs Razorpay

```
                    STRIPE              RAZORPAY
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Geography          International       India focus
Payment Methods    Cards only          UPI, Cards, Netbanking
Checkout Type      Hosted Checkout     Popup (embedded)
Webhook            Async               N/A (direct verify)
Verification       Signature + Event   HMAC-SHA256
User Experience    Redirect flow       Popup flow
Latency            2-5 seconds         Instant
Testing            4242 card           success@razorpay
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
```

---

## ğŸ“Š State Transitions

```
Before Payment:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ User (Free)                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ is_premium: false                â”‚
â”‚ premium_since: NULL              â”‚
â”‚ premium_until: NULL              â”‚
â”‚                                  â”‚
â”‚ Features:                        â”‚
â”‚ - Max 3 shelves                  â”‚
â”‚ - Max 12 books                   â”‚
â”‚ - Basic stats                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

During Payment:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ User (Processing)                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Payment in progress...           â”‚
â”‚ Stripe/Razorpay handling         â”‚
â”‚ Signature verification pending   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

After Successful Payment:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ User (Premium)                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ is_premium: true                 â”‚
â”‚ premium_since: 2024-01-19        â”‚
â”‚ premium_until: 2025-01-19        â”‚
â”‚                                  â”‚
â”‚ Features:                        â”‚
â”‚ âœ… Unlimited shelves             â”‚
â”‚ âœ… Unlimited books               â”‚
â”‚ âœ… Advanced stats                â”‚
â”‚ âœ… All premium features          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

After Expiration:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ User (Expired)                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ is_premium: true (but expired)   â”‚
â”‚ premium_until: 2025-01-19 (past) â”‚
â”‚                                  â”‚
â”‚ Features:                        â”‚
â”‚ âŒ Upgraded features locked      â”‚
â”‚ âœ… Basic features still work     â”‚
â”‚                                  â”‚
â”‚ Action: "Renew Premium"          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ” Security Verification Layers

```
STRIPE:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. HTTPS Connection                     â”‚
â”‚    âœ“ Encrypted transmission              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 2. Session Authentication               â”‚
â”‚    âœ“ User must be logged in              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 3. Webhook Signature Verification       â”‚
â”‚    âœ“ HMAC-SHA256 validation              â”‚
â”‚    âœ“ Using STRIPE_WEBHOOK_SECRET         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 4. User ID Matching                     â”‚
â”‚    âœ“ From session (not user input)       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 5. Amount Verification                  â”‚
â”‚    âœ“ Hardcoded (not from user)           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

RAZORPAY:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. HTTPS Connection                     â”‚
â”‚    âœ“ Encrypted transmission              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 2. Session Authentication               â”‚
â”‚    âœ“ User must be logged in              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 3. HMAC-SHA256 Signature Verification   â”‚
â”‚    âœ“ On order_id | payment_id            â”‚
â”‚    âœ“ Using RAZORPAY_KEY_SECRET           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 4. Order ID Validation                  â”‚
â”‚    âœ“ Matches created order               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 5. User ID Matching                     â”‚
â”‚    âœ“ From session (not user input)       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 6. Amount Verification                  â”‚
â”‚    âœ“ Hardcoded (not from user)           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ¯ Decision Flow (User Making Payment)

```
                        User at /pricing
                              â”‚
                              â†“
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ Choose Payment      â”‚
                    â”‚ Method              â”‚
                    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
                           â”‚        â”‚
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â†“                              â†“
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ STRIPE (Cards)   â”‚          â”‚ RAZORPAY (UPI)   â”‚
        â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤          â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
        â”‚ ğŸ’³ International â”‚          â”‚ ğŸ‡®ğŸ‡³ India focus   â”‚
        â”‚ âœ“ All cards      â”‚          â”‚ âœ“ UPI, Card      â”‚
        â”‚ âœ“ Secure         â”‚          â”‚ âœ“ Fast           â”‚
        â”‚                  â”‚          â”‚                  â”‚
        â”‚ [Pay with Card]  â”‚          â”‚ [Pay with UPI]   â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚                             â”‚
                 â†“                             â†“
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ Stripe Checkout  â”‚          â”‚ Razorpay Popup   â”‚
        â”‚ - Hosted page    â”‚          â”‚ - Modal dialog   â”‚
        â”‚ - Full form      â”‚          â”‚ - Quick method   â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚                             â”‚
                 â†“                             â†“
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ Enter Card:      â”‚          â”‚ Select UPI:      â”‚
        â”‚ 4242...4242      â”‚          â”‚ success@...      â”‚
        â”‚ Expiry: 12/25    â”‚          â”‚                  â”‚
        â”‚ CVC: 123         â”‚          â”‚ [Proceed]        â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚                             â”‚
                 â†“                             â†“
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ [Complete Pay]   â”‚          â”‚ [Confirm UPI]    â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚                             â”‚
                 â†“                             â†“
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ Stripe Webhook   â”‚          â”‚ Direct Verify    â”‚
        â”‚ (Asynchronous)   â”‚          â”‚ (Synchronous)    â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚                             â”‚
                 â†“                             â†“
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ /webhook/stripe  â”‚          â”‚ /verify-razorpay â”‚
        â”‚ Signature check  â”‚          â”‚ Signature check  â”‚
        â”‚ Update DB        â”‚          â”‚ Update DB        â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚                             â”‚
                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â†“
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ User Premium Status     â”‚
                    â”‚ - is_premium = TRUE     â”‚
                    â”‚ - Expires: 2025-01-19   â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â†“
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ /dashboard              â”‚
                    â”‚ ğŸ‰ Premium features!    â”‚
                    â”‚ âœ… Unlimited shelves    â”‚
                    â”‚ âœ… Unlimited books      â”‚
                    â”‚ âœ… All premium features â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“ˆ Database Changes Over Time

```
TIMELINE:

T=0  User Signup
     â”œâ”€ id: 123
     â”œâ”€ email: user@example.com
     â”œâ”€ is_premium: FALSE
     â”œâ”€ premium_since: NULL
     â””â”€ premium_until: NULL

T=1000s  User Navigates to /pricing

T=1001s  User Clicks Payment Button
         Payment Gateway Opens

T=1030s  User Completes Payment
         â”œâ”€ Payment succeeds
         â”œâ”€ Signature verified
         â”œâ”€ No changes yet (pending webhook)

T=1031s  [WEBHOOK ARRIVES]
         â”œâ”€ id: 123
         â”œâ”€ email: user@example.com
         â”œâ”€ is_premium: TRUE â† Changed!
         â”œâ”€ premium_since: 2024-01-19 10:30:00 â† Set!
         â””â”€ premium_until: 2025-01-19 10:30:00 â† Set!

T=1032s  User Redirected to Dashboard
         â””â”€ Premium badge displayed â­

...

T=31536000s (After 365 days)
         â”œâ”€ id: 123
         â”œâ”€ is_premium: TRUE (expired)
         â”œâ”€ premium_since: 2024-01-19
         â””â”€ premium_until: 2025-01-19 (PAST) â† Expired!
         
         Shows: "Your premium expired"
         Offers: "Renew Premium"
```

---

## ğŸ“ Complete Documentation Map

```
User Journey:
  Start â†’ Dashboard â†’ "Upgrade" â†’ /pricing â†’ Choose method
    â”œâ”€ Stripe path â†’ Checkout â†’ Complete â†’ Webhook â†’ Premium
    â””â”€ Razorpay path â†’ Popup â†’ Complete â†’ Verify â†’ Premium

Documentation:
  ğŸ“– PAYMENT_SYSTEM_README.md â† Start here (overview)
     â†“
  ğŸ“‹ PAYMENT_SETUP_STEPS.md â† For step-by-step setup
     â†“
  ğŸš€ PAYMENT_QUICK_REFERENCE.md â† API reference
     â†“
  ğŸ—ï¸ PAYMENT_ARCHITECTURE.md â† Technical deep dive
     â†“
  âœ¨ PAYMENT_IMPLEMENTATION_SUMMARY.md â† What's done
     â†“
  ğŸ¯ This file (PAYMENT_VISUAL_GUIDE.md) â† You are here!

Code Structure:
  app.py
    â”œâ”€ Payment imports & initialization
    â”œâ”€ /create-checkout-session (Stripe)
    â”œâ”€ /payment/success (Stripe)
    â”œâ”€ /webhook/stripe (Stripe)
    â”œâ”€ /create-razorpay-order (Razorpay)
    â””â”€ /verify-razorpay-payment (Razorpay)

Configuration:
  .env
    â”œâ”€ STRIPE_SECRET_KEY
    â”œâ”€ STRIPE_WEBHOOK_SECRET
    â”œâ”€ RAZORPAY_KEY_ID
    â””â”€ RAZORPAY_KEY_SECRET
```

---

**Created:** 2024-01-19
**Status:** Complete & Production-Ready
**Version:** 1.0
